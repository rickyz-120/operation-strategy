{% extends "base.html" %}

{% block page_title %}Relatórios e Análises{% endblock %}

{% block content %}
<div class="fade-in">
    <!-- Report Generation Controls -->
    <div class="neu-card">
        <h3 style="margin-bottom: 1.5rem; color: var(--text-primary);">Geração de Relatórios</h3>
        <div class="report-controls">
            <div class="control-group">
                <label for="report-type">Tipo de Relatório:</label>
                <select id="report-type" class="neu-select">
                    <option value="operational">Relatório Operacional</option>
                    <option value="financial">Análise Financeira</option>
                    <option value="efficiency">Eficiência de Motoristas</option>
                    <option value="routes">Análise de Rotas</option>
                    <option value="maintenance">Manutenção de Veículos</option>
                    <option value="environmental">Impacto Ambiental</option>
                </select>
            </div>
            
            <div class="control-group">
                <label for="date-range">Período:</label>
                <select id="date-range" class="neu-select">
                    <option value="last-week">Última Semana</option>
                    <option value="last-month">Último Mês</option>
                    <option value="last-quarter">Último Trimestre</option>
                    <option value="last-year">Último Ano</option>
                    <option value="custom">Período Personalizado</option>
                </select>
            </div>
            
            <div class="control-group">
                <label for="format">Formato:</label>
                <select id="format" class="neu-select">
                    <option value="pdf">PDF</option>
                    <option value="excel">Excel</option>
                    <option value="csv">CSV</option>
                </select>
            </div>
            
            <button class="neu-button primary" onclick="generateReport()">
                <i class="fas fa-file-alt"></i> Gerar Relatório
            </button>
        </div>
    </div>

    <!-- Quick Reports -->
    <div class="neu-card">
        <h3 style="margin-bottom: 1.5rem; color: var(--text-primary);">Relatórios Rápidos</h3>
        <div class="quick-reports-grid">
            <div class="quick-report-item" onclick="generateQuickReport('daily-summary')">
                <i class="fas fa-calendar-day"></i>
                <h4>Resumo Diário</h4>
                <p>Operações, custos e performance do dia</p>
            </div>
            
            <div class="quick-report-item" onclick="generateQuickReport('fuel-consumption')">
                <i class="fas fa-gas-pump"></i>
                <h4>Consumo de Combustível</h4>
                <p>Análise detalhada de consumo por veículo</p>
            </div>
            
            <div class="quick-report-item" onclick="generateQuickReport('driver-performance')">
                <i class="fas fa-users"></i>
                <h4>Performance de Motoristas</h4>
                <p>Ranking e métricas individuais</p>
            </div>
            
            <div class="quick-report-item" onclick="generateQuickReport('cost-analysis')">
                <i class="fas fa-chart-pie"></i>
                <h4>Análise de Custos</h4>
                <p>Breakdown detalhado de despesas</p>
            </div>
            
            <div class="quick-report-item" onclick="generateQuickReport('route-optimization')">
                <i class="fas fa-route"></i>
                <h4>Otimização de Rotas</h4>
                <p>Eficiência e sugestões de melhoria</p>
            </div>
            
            <div class="quick-report-item" onclick="generateQuickReport('environmental-impact')">
                <i class="fas fa-leaf"></i>
                <h4>Impacto Ambiental</h4>
                <p>Emissões e pegada de carbono</p>
            </div>
        </div>
    </div>

    <!-- Recent Reports -->
    <div class="neu-card">
        <h3 style="margin-bottom: 1.5rem; color: var(--text-primary);">Relatórios Recentes</h3>
        <div class="recent-reports">
            <div class="report-item">
                <div class="report-info">
                    <i class="fas fa-file-pdf"></i>
                    <div>
                        <h4>Relatório Operacional - Dezembro 2024</h4>
                        <span class="report-date">Gerado em 03/01/2025 às 14:30</span>
                    </div>
                </div>
                <div class="report-actions">
                    <button class="neu-button small" onclick="downloadReport('operational-dec-2024.pdf')">
                        <i class="fas fa-download"></i>
                    </button>
                    <button class="neu-button small" onclick="viewReport('operational-dec-2024')">
                        <i class="fas fa-eye"></i>
                    </button>
                </div>
            </div>
            
            <div class="report-item">
                <div class="report-info">
                    <i class="fas fa-file-excel"></i>
                    <div>
                        <h4>Análise de Custos - Q4 2024</h4>
                        <span class="report-date">Gerado em 02/01/2025 às 09:15</span>
                    </div>
                </div>
                <div class="report-actions">
                    <button class="neu-button small" onclick="downloadReport('costs-q4-2024.xlsx')">
                        <i class="fas fa-download"></i>
                    </button>
                    <button class="neu-button small" onclick="viewReport('costs-q4-2024')">
                        <i class="fas fa-eye"></i>
                    </button>
                </div>
            </div>
            
            <div class="report-item">
                <div class="report-info">
                    <i class="fas fa-file-csv"></i>
                    <div>
                        <h4>Performance de Motoristas - Dezembro</h4>
                        <span class="report-date">Gerado em 01/01/2025 às 16:45</span>
                    </div>
                </div>
                <div class="report-actions">
                    <button class="neu-button small" onclick="downloadReport('drivers-dec-2024.csv')">
                        <i class="fas fa-download"></i>
                    </button>
                    <button class="neu-button small" onclick="viewReport('drivers-dec-2024')">
                        <i class="fas fa-eye"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Analytics Dashboard -->
    <div class="neu-card">
        <h3 style="margin-bottom: 1.5rem; color: var(--text-primary);">Dashboard de Análises</h3>
        <div class="analytics-grid">
            <div class="analytics-item">
                <h4>KPIs Principais</h4>
                <div class="kpi-list">
                    <div class="kpi-item">
                        <span class="kpi-label">Eficiência Operacional</span>
                        <span class="kpi-value good">92.5%</span>
                    </div>
                    <div class="kpi-item">
                        <span class="kpi-label">Redução de Custos</span>
                        <span class="kpi-value good">15.2%</span>
                    </div>
                    <div class="kpi-item">
                        <span class="kpi-label">Satisfação do Cliente</span>
                        <span class="kpi-value excellent">96.8%</span>
                    </div>
                    <div class="kpi-item">
                        <span class="kpi-label">Pontualidade</span>
                        <span class="kpi-value good">89.3%</span>
                    </div>
                </div>
            </div>
            
            <div class="analytics-item">
                <h4>Tendências Mensais</h4>
                <div class="trend-chart">
                    <canvas id="trendsChart" width="300" height="200"></canvas>
                </div>
            </div>
            
            <div class="analytics-item">
                <h4>Alertas e Recomendações</h4>
                <div class="alerts-recommendations">
                    <div class="alert-recommendation success">
                        <i class="fas fa-check-circle"></i>
                        <span>Consumo de combustível 8% abaixo da meta</span>
                    </div>
                    <div class="alert-recommendation warning">
                        <i class="fas fa-exclamation-triangle"></i>
                        <span>3 veículos precisam de manutenção preventiva</span>
                    </div>
                    <div class="alert-recommendation info">
                        <i class="fas fa-lightbulb"></i>
                        <span>Oportunidade de otimização na rota SP-RJ</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Export Options -->
    <div class="neu-card">
        <h3 style="margin-bottom: 1.5rem; color: var(--text-primary);">Opções de Exportação</h3>
        <div class="export-options">
            <div class="export-category">
                <h4>Dados Operacionais</h4>
                <div class="export-buttons">
                    <button class="neu-button" onclick="exportData('routes')">
                        <i class="fas fa-route"></i> Exportar Rotas
                    </button>
                    <button class="neu-button" onclick="exportData('drivers')">
                        <i class="fas fa-users"></i> Exportar Motoristas
                    </button>
                    <button class="neu-button" onclick="exportData('vehicles')">
                        <i class="fas fa-truck"></i> Exportar Veículos
                    </button>
                </div>
            </div>
            
            <div class="export-category">
                <h4>Dados Financeiros</h4>
                <div class="export-buttons">
                    <button class="neu-button" onclick="exportData('costs')">
                        <i class="fas fa-dollar-sign"></i> Exportar Custos
                    </button>
                    <button class="neu-button" onclick="exportData('fuel-expenses')">
                        <i class="fas fa-gas-pump"></i> Exportar Combustível
                    </button>
                    <button class="neu-button" onclick="exportData('maintenance')">
                        <i class="fas fa-tools"></i> Exportar Manutenção
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.report-controls {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1.5rem;
    align-items: end;
}

.control-group {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.control-group label {
    font-weight: 600;
    color: var(--text-primary);
    font-size: 0.9rem;
}

.quick-reports-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
}

.quick-report-item {
    padding: 2rem;
    background-color: var(--bg-primary);
    border-radius: 15px;
    box-shadow: var(--shadow-pressed);
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
}

.quick-report-item:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-raised);
}

.quick-report-item i {
    font-size: 3rem;
    color: var(--accent-primary);
    margin-bottom: 1rem;
}

.quick-report-item h4 {
    color: var(--text-primary);
    margin-bottom: 0.5rem;
}

.quick-report-item p {
    color: var(--text-muted);
    font-size: 0.9rem;
    line-height: 1.4;
}

.recent-reports {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.report-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1.5rem;
    background-color: var(--bg-primary);
    border-radius: 15px;
    box-shadow: var(--shadow-pressed);
}

.report-info {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.report-info i {
    font-size: 2rem;
    color: var(--accent-primary);
}

.report-info h4 {
    color: var(--text-primary);
    margin: 0 0 0.3rem 0;
}

.report-date {
    color: var(--text-muted);
    font-size: 0.8rem;
}

.report-actions {
    display: flex;
    gap: 0.5rem;
}

.analytics-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 2rem;
}

.analytics-item {
    padding: 1.5rem;
    background-color: var(--bg-primary);
    border-radius: 15px;
    box-shadow: var(--shadow-pressed);
}

.analytics-item h4 {
    color: var(--text-primary);
    margin-bottom: 1rem;
}

.kpi-list {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.kpi-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.8rem;
    background-color: var(--bg-primary);
    border-radius: 10px;
    box-shadow: var(--shadow-pressed);
}

.kpi-label {
    color: var(--text-secondary);
    font-size: 0.9rem;
}

.kpi-value {
    font-weight: 700;
    font-size: 1.1rem;
}

.kpi-value.excellent {
    color: var(--success);
}

.kpi-value.good {
    color: var(--accent-primary);
}

.kpi-value.average {
    color: var(--warning);
}

.kpi-value.poor {
    color: var(--danger);
}

.alerts-recommendations {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.alert-recommendation {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem;
    border-radius: 10px;
    font-size: 0.9rem;
    box-shadow: var(--shadow-pressed);
}

.alert-recommendation.success {
    background-color: rgba(40, 167, 69, 0.1);
    color: var(--success);
}

.alert-recommendation.warning {
    background-color: rgba(255, 193, 7, 0.1);
    color: var(--warning);
}

.alert-recommendation.info {
    background-color: rgba(74, 144, 226, 0.1);
    color: var(--accent-primary);
}

.export-options {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 2rem;
}

.export-category {
    padding: 1.5rem;
    background-color: var(--bg-primary);
    border-radius: 15px;
    box-shadow: var(--shadow-pressed);
}

.export-category h4 {
    color: var(--text-primary);
    margin-bottom: 1rem;
}

.export-buttons {
    display: flex;
    flex-direction: column;
    gap: 0.8rem;
}

.export-buttons .neu-button {
    justify-content: flex-start;
    text-align: left;
}

.export-buttons .neu-button i {
    margin-right: 0.8rem;
    width: 20px;
}
</style>
{% endblock %}

{% block extra_scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    initializeTrendsChart();
});

function initializeTrendsChart() {
    const ctx = document.getElementById('trendsChart').getContext('2d');
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun'],
            datasets: [{
                label: 'Eficiência (%)',
                data: [85, 87, 89, 88, 92, 94],
                borderColor: '#4a90e2',
                backgroundColor: 'rgba(74, 144, 226, 0.1)',
                borderWidth: 2,
                fill: true,
                tension: 0.4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                }
            },
            scales: {
                y: {
                    beginAtZero: false,
                    min: 80,
                    ticks: {
                        color: '#000000',
                        font: {
                            size: 10
                        }
                    },
                    grid: {
                        color: 'rgba(0, 0, 0, 0.1)'
                    }
                },
                x: {
                    ticks: {
                        color: '#000000',
                        font: {
                            size: 10
                        }
                    },
                    grid: {
                        color: 'rgba(0, 0, 0, 0.1)'
                    }
                }
            }
        }
    });
}

function generateReport() {
    const reportType = document.getElementById('report-type').value;
    const dateRange = document.getElementById('date-range').value;
    const format = document.getElementById('format').value;
    
    console.log(`Generating ${reportType} report for ${dateRange} in ${format} format`);
    
    // Show loading state
    const button = event.target;
    const originalText = button.innerHTML;
    button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Gerando...';
    button.disabled = true;
    
    // Simulate report generation
    setTimeout(() => {
        button.innerHTML = originalText;
        button.disabled = false;
        alert('Relatório gerado com sucesso!');
    }, 2000);
}

function generateQuickReport(reportType) {
    console.log(`Generating quick report: ${reportType}`);
    alert(`Gerando relatório: ${reportType}`);
}

function downloadReport(filename) {
    console.log(`Downloading report: ${filename}`);
    alert(`Download iniciado: ${filename}`);
}

function viewReport(reportId) {
    console.log(`Viewing report: ${reportId}`);
    alert(`Visualizando relatório: ${reportId}`);
}

function exportData(dataType) {
    console.log(`Exporting data: ${dataType}`);
    alert(`Exportando dados: ${dataType}`);
}
</script>
{% endblock %}
