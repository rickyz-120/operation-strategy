{% extends "base.html" %}

{% block page_title %}Gestão de Veículos{% endblock %}

{% block content %}
<div class="fade-in">
    <!-- Vehicle Statistics -->
    <div class="metrics-grid">
        <div class="metric-card">
            <div class="metric-icon">
                <i class="fas fa-truck"></i>
            </div>
            <div class="metric-value">{{ vehicles|length }}</div>
            <div class="metric-label">Total de Veículos</div>
        </div>
        
        <div class="metric-card">
            <div class="metric-icon">
                <i class="fas fa-check-circle"></i>
            </div>
            <div class="metric-value">{{ vehicles|selectattr("status", "equalto", "Disponível")|list|length }}</div>
            <div class="metric-label">Veículos Disponíveis</div>
        </div>
        
        <div class="metric-card">
            <div class="metric-icon">
                <i class="fas fa-gas-pump"></i>
            </div>
            <div class="metric-value">{{ "%.1f"|format((vehicles|sum(attribute="avg_consumption")/vehicles|length)) }}</div>
            <div class="metric-label">Consumo Médio (km/L)</div>
        </div>
        
        <div class="metric-card">
            <div class="metric-icon">
                <i class="fas fa-tools"></i>
            </div>
            <div class="metric-value">R$ {{ "{:,.0f}".format((vehicles|sum(attribute="maintenance_cost")/vehicles|length)) }}</div>
            <div class="metric-label">Custo Médio Manutenção</div>
        </div>
    </div>

    <!-- Vehicle Filter and Controls -->
    <div class="neu-card">
        <div class="vehicle-controls">
            <h3>Filtros e Controles</h3>
            <div class="filter-controls">
                <select class="neu-select" id="fuel-filter">
                    <option value="">Todos os Combustíveis</option>
                    <option value="Diesel S10">Diesel S10</option>
                    <option value="Gasolina">Gasolina</option>
                </select>
                <select class="neu-select" id="status-filter">
                    <option value="">Todos os Status</option>
                    <option value="Disponível">Disponível</option>
                    <option value="Em Uso">Em Uso</option>
                    <option value="Manutenção">Manutenção</option>
                </select>
                <button class="neu-button primary" onclick="addVehicle()">
                    <i class="fas fa-plus"></i> Adicionar Veículo
                </button>
            </div>
        </div>
    </div>

    <!-- Vehicles Grid -->
    <div class="vehicles-grid">
        {% for vehicle in vehicles %}
        <div class="vehicle-card" data-fuel="{{ vehicle.fuel_type }}" data-status="{{ vehicle.status }}">
            <div class="vehicle-header">
                <div class="vehicle-icon">
                    <i class="fas fa-truck"></i>
                </div>
                <div class="vehicle-info">
                    <h4>{{ vehicle.model }}</h4>
                    <span class="vehicle-plate">{{ vehicle.plate }}</span>
                </div>
                <span class="status-badge status-{{ vehicle.status.lower().replace(' ', '-') }}">
                    {{ vehicle.status }}
                </span>
            </div>
            
            <div class="vehicle-specs">
                <div class="spec-item">
                    <i class="fas fa-gas-pump"></i>
                    <div>
                        <span class="spec-label">Combustível</span>
                        <span class="spec-value">{{ vehicle.fuel_type }}</span>
                    </div>
                </div>
                
                <div class="spec-item">
                    <i class="fas fa-tachometer-alt"></i>
                    <div>
                        <span class="spec-label">Consumo</span>
                        <span class="spec-value">{{ vehicle.avg_consumption }} km/L</span>
                    </div>
                </div>
                
                <div class="spec-item">
                    <i class="fas fa-weight-hanging"></i>
                    <div>
                        <span class="spec-label">Capacidade</span>
                        <span class="spec-value">{{ "{:,}".format(vehicle.cargo_capacity) }} kg</span>
                    </div>
                </div>
                
                <div class="spec-item">
                    <i class="fas fa-tools"></i>
                    <div>
                        <span class="spec-label">Manutenção</span>
                        <span class="spec-value">R$ {{ "{:,}".format(vehicle.maintenance_cost) }}</span>
                    </div>
                </div>
            </div>
            
            <div class="vehicle-actions">
                <!-- Fixed JavaScript function calls with proper parameter passing -->
                <button class="neu-button small" onclick="viewVehicle('{{ vehicle.id }}')">
                    <i class="fas fa-eye"></i> Detalhes
                </button>
                <button class="neu-button small" onclick="scheduleMaintenance('{{ vehicle.id }}')">
                    <i class="fas fa-wrench"></i> Manutenção
                </button>
                <button class="neu-button small primary" onclick="assignRoute('{{ vehicle.id }}')">
                    <i class="fas fa-route"></i> Atribuir Rota
                </button>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- Electric Vehicle Analysis -->
    <div class="neu-card">
        <h3 style="margin-bottom: 1.5rem; color: var(--text-primary);">Análise de Veículos Elétricos</h3>
        <div class="ev-analysis">
            <div class="ev-comparison">
                <div class="comparison-item">
                    <h4>Veículos Convencionais</h4>
                    <div class="comparison-metrics">
                        <div class="metric">
                            <span class="metric-label">Custo Mensal Combustível</span>
                            <span class="metric-value">R$ 45.780</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Emissões CO₂</span>
                            <span class="metric-value">12.5 ton/mês</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Manutenção</span>
                            <span class="metric-value">R$ 8.500/mês</span>
                        </div>
                    </div>
                </div>
                
                <div class="comparison-arrow">
                    <i class="fas fa-arrow-right"></i>
                </div>
                
                <div class="comparison-item ev-item">
                    <h4>Veículos Elétricos</h4>
                    <div class="comparison-metrics">
                        <div class="metric">
                            <span class="metric-label">Custo Mensal Energia</span>
                            <span class="metric-value savings">R$ 15.900</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Emissões CO₂</span>
                            <span class="metric-value savings">4.4 ton/mês</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Manutenção</span>
                            <span class="metric-value savings">R$ 3.200/mês</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="ev-benefits">
                <div class="benefit-item">
                    <i class="fas fa-leaf"></i>
                    <div>
                        <h5>Redução de 65% nas Emissões</h5>
                        <p>Contribuição significativa para sustentabilidade</p>
                    </div>
                </div>
                <div class="benefit-item">
                    <i class="fas fa-dollar-sign"></i>
                    <div>
                        <h5>Economia de R$ 34.180/mês</h5>
                        <p>Retorno do investimento em 3.2 anos</p>
                    </div>
                </div>
                <div class="benefit-item">
                    <i class="fas fa-chart-line"></i>
                    <div>
                        <h5>Menor Custo Operacional</h5>
                        <p>Redução de 62% nos custos de manutenção</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.vehicle-controls {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 1rem;
}

.filter-controls {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
    align-items: center;
}

.filter-controls .neu-select {
    min-width: 200px;
}

.vehicles-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    gap: 2rem;
    margin-top: 2rem;
}

.vehicle-card {
    background-color: var(--bg-primary);
    border-radius: 20px;
    padding: 2rem;
    box-shadow: var(--shadow-raised);
    transition: all 0.3s ease;
}

.vehicle-card:hover {
    transform: translateY(-2px);
    box-shadow: 8px 8px 16px var(--shadow-dark), -8px -8px 16px var(--shadow-light);
}

.vehicle-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 1.5rem;
}

.vehicle-icon {
    width: 50px;
    height: 50px;
    background-color: var(--accent-primary);
    border-radius: 15px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 1.5rem;
    box-shadow: var(--shadow-raised);
}

.vehicle-info h4 {
    color: var(--text-primary);
    margin: 0;
    font-size: 1.2rem;
}

.vehicle-plate {
    color: var(--text-muted);
    font-size: 0.9rem;
    font-weight: 600;
}

.vehicle-specs {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    margin-bottom: 1.5rem;
}

.spec-item {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 0.8rem;
    background-color: var(--bg-primary);
    border-radius: 12px;
    box-shadow: var(--shadow-pressed);
}

.spec-item i {
    color: var(--accent-secondary);
    font-size: 1.2rem;
    width: 20px;
}

.spec-label {
    display: block;
    font-size: 0.8rem;
    color: var(--text-muted);
}

.spec-value {
    display: block;
    font-weight: 600;
    color: var(--text-primary);
}

.vehicle-actions {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
}

.status-disponível {
    background-color: var(--success);
    color: white;
}

.status-em-uso {
    background-color: var(--accent-primary);
    color: white;
}

.status-manutenção {
    background-color: var(--danger);
    color: white;
}

.ev-analysis {
    display: flex;
    flex-direction: column;
    gap: 2rem;
}

.ev-comparison {
    display: grid;
    grid-template-columns: 1fr auto 1fr;
    gap: 2rem;
    align-items: center;
}

.comparison-item {
    padding: 2rem;
    background-color: var(--bg-primary);
    border-radius: 20px;
    box-shadow: var(--shadow-pressed);
}

.ev-item {
    border: 2px solid var(--success);
}

.comparison-item h4 {
    color: var(--text-primary);
    margin-bottom: 1.5rem;
    text-align: center;
}

.comparison-metrics {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.comparison-metrics .metric {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.comparison-metrics .metric-label {
    color: var(--text-muted);
    font-size: 0.9rem;
}

.comparison-metrics .metric-value {
    font-weight: 600;
    color: var(--text-primary);
}

.comparison-metrics .metric-value.savings {
    color: var(--success);
}

.comparison-arrow {
    font-size: 2rem;
    color: var(--accent-primary);
    text-align: center;
}

.ev-benefits {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
}

.benefit-item {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1.5rem;
    background-color: var(--bg-primary);
    border-radius: 15px;
    box-shadow: var(--shadow-pressed);
}

.benefit-item i {
    font-size: 2rem;
    color: var(--success);
}

.benefit-item h5 {
    color: var(--text-primary);
    margin: 0 0 0.5rem 0;
}

.benefit-item p {
    color: var(--text-muted);
    margin: 0;
    font-size: 0.9rem;
}

@media (max-width: 768px) {
    .ev-comparison {
        grid-template-columns: 1fr;
    }
    
    .comparison-arrow {
        transform: rotate(90deg);
    }
}
</style>
{% endblock %}

{% block extra_scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    console.log('Vehicles page loaded successfully');
    
    // Initialize filter functionality
    const fuelFilter = document.getElementById('fuel-filter');
    const statusFilter = document.getElementById('status-filter');
    
    if (fuelFilter) {
        fuelFilter.addEventListener('change', filterVehicles);
    }
    
    if (statusFilter) {
        statusFilter.addEventListener('change', filterVehicles);
    }
});

function filterVehicles() {
    try {
        const fuelFilter = document.getElementById('fuel-filter');
        const statusFilter = document.getElementById('status-filter');
        
        if (!fuelFilter || !statusFilter) return;
        
        const fuelValue = fuelFilter.value;
        const statusValue = statusFilter.value;
        const vehicleCards = document.querySelectorAll('.vehicle-card');
        
        vehicleCards.forEach(card => {
            const fuel = card.dataset.fuel || '';
            const status = card.dataset.status || '';
            
            const showFuel = !fuelValue || fuel === fuelValue;
            const showStatus = !statusValue || status === statusValue;
            
            if (showFuel && showStatus) {
                card.style.display = 'block';
            } else {
                card.style.display = 'none';
            }
        });
    } catch (error) {
        console.error('Error filtering vehicles:', error);
    }
}

function viewVehicle(vehicleId) {
    console.log('Viewing vehicle:', vehicleId);
}

function scheduleMaintenance(vehicleId) {
    console.log('Scheduling maintenance for vehicle:', vehicleId);
}

function assignRoute(vehicleId) {
    console.log('Assigning route to vehicle:', vehicleId);
}

function addVehicle() {
    console.log('Adding new vehicle');
}
</script>
{% endblock %}
